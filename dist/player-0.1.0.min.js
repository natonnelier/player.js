!function(e,t){var n={};function i(e){return function(){var t={method:e},i=Array.prototype.slice.call(arguments);/^get/.test(e)?(n.assert(i.length>0,"Get methods require a callback."),i.unshift(t)):(/^set/.test(e)&&(n.assert(0!==i.length,"Set methods require a value."),t.value=i[0]),i=[t]),this.send.apply(this,i)}}n.DEBUG=!1,n.VERSION="0.0.11",n.CONTEXT="player.js",n.POST_MESSAGE=!!e.postMessage,n.origin=function(t){return"//"===t.substr(0,2)&&(t=e.location.protocol+t),t.split("/").slice(0,3).join("/")},n.addEvent=function(e,t,n){e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)},n.log=function(){n.log.history=n.log.history||[],n.log.history.push(arguments),e.console&&n.DEBUG&&e.console.log(Array.prototype.slice.call(arguments))},n.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},n.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.isNone=function(e){return null===e||void 0===e},n.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.indexOf=function(e,t){if(null==e)return-1;var n=0,i=e.length;if(Array.prototype.IndexOf&&e.indexOf===Array.prototype.IndexOf)return e.indexOf(t);for(;n<i;n++)if(e[n]===t)return n;return-1},n.assert=function(e,t){if(!e)throw t||"Player.js Assert Failed"},n.Keeper=function(){this.init()},n.Keeper.prototype.init=function(){this.data={}},n.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},n.Keeper.prototype.has=function(e,t){if(!this.data.hasOwnProperty(e))return!1;if(n.isNone(t))return!0;for(var i=this.data[e],r=0;r<i.length;r++)if(i[r].id===t)return!0;return!1},n.Keeper.prototype.add=function(e,t,n,i,r){var o={id:e,event:t,cb:n,ctx:i,one:r};this.has(t)?this.data[t].push(o):this.data[t]=[o]},n.Keeper.prototype.execute=function(e,t,i,r){if(!this.has(e,t))return!1;for(var o=[],s=[],a=0;a<this.data[e].length;a++){var u=this.data[e][a];n.isNone(t)||!n.isNone(t)&&u.id===t?(s.push({cb:u.cb,ctx:u.ctx?u.ctx:r,data:i}),!1===u.one&&o.push(u)):o.push(u)}0===o.length?delete this.data[e]:this.data[e]=o;for(var c=0;c<s.length;c++){var d=s[c];d.cb.call(d.ctx,d.data)}},n.Keeper.prototype.on=function(e,t,n,i){this.add(e,t,n,i,!1)},n.Keeper.prototype.one=function(e,t,n,i){this.add(e,t,n,i,!0)},n.Keeper.prototype.off=function(e,t){var i=[];if(!this.data.hasOwnProperty(e))return i;for(var r=[],o=0;o<this.data[e].length;o++){var s=this.data[e][o];n.isNone(t)||s.cb===t?n.isNone(s.id)||i.push(s.id):r.push(s)}return 0===r.length?delete this.data[e]:this.data[e]=r,i},n.Player=function(e,t){if(!(this instanceof n.Player))return new n.Player(e,t);this.init(e,t)},n.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",ERROR:"error"},n.EVENTS.all=function(){var e=[];for(var t in n.EVENTS)n.has(n.EVENTS,t)&&n.isString(n.EVENTS[t])&&e.push(n.EVENTS[t]);return e},n.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},n.METHODS.all=function(){var e=[];for(var t in n.METHODS)n.has(n.METHODS,t)&&n.isString(n.METHODS[t])&&e.push(n.METHODS[t]);return e},n.READIED=[],n.Player.prototype.init=function(i,r){var o=this;n.isString(i)&&(i=t.getElementById(i)),this.elem=i,n.assert("IFRAME"===i.nodeName,'playerjs.Player constructor requires an Iframe, got "'+i.nodeName+'"'),n.assert(i.src,"playerjs.Player constructor requires a Iframe with a 'src' attribute."),this.origin=n.origin(i.src),this.keeper=new n.Keeper,this.isReady=!1,this.queue=[],this.events=n.EVENTS.all(),this.methods=n.METHODS.all(),n.POST_MESSAGE?n.addEvent(e,"message",function(e){o.receive(e)}):n.log("Post Message is not Available."),n.indexOf(n.READIED,i.src)>-1?o.loaded=!0:this.elem.onload=function(){o.loaded=!0}},n.Player.prototype.send=function(e,t,i){if(e.context=n.CONTEXT,e.version=n.VERSION,t){var r=this.keeper.getUUID();e.listener=r,this.keeper.one(r,e.method,t,i)}return this.isReady||"ready"===e.value?(n.log("Player.send",e,this.origin),!0===this.loaded&&this.elem.contentWindow.postMessage(JSON.stringify(e),this.origin),!0):(n.log("Player.queue",e),this.queue.push(e),!1)},n.Player.prototype.receive=function(e){if(n.log("Player.receive",e),e.origin!==this.origin)return!1;var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==n.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src===this.elem.src&&this.ready(t),this.keeper.has(t.event,t.listener)&&this.keeper.execute(t.event,t.listener,t.value,this)},n.Player.prototype.ready=function(e){if(!0===this.isReady)return!1;e.value.events&&(this.events=e.value.events),e.value.methods&&(this.methods=e.value.methods),this.isReady=!0,this.loaded=!0;for(var t=0;t<this.queue.length;t++){var i=this.queue[t];n.log("Player.dequeue",i),"ready"===e.event&&this.keeper.execute(i.event,i.listener,!0,this),this.send(i)}this.queue=[]},n.Player.prototype.on=function(e,t,n){var i=this.keeper.getUUID();return"ready"===e?this.keeper.one(i,e,t,n):this.keeper.on(i,e,t,n),this.send({method:"addEventListener",value:e,listener:i}),!0},n.Player.prototype.off=function(e,t){var i=this.keeper.off(e,t);if(n.log("Player.off",i),i.length>0)for(var r in i)return this.send({method:"removeEventListener",value:e,listener:i[r]}),!0;return!1},n.Player.prototype.supports=function(e,t){n.assert(n.indexOf(["method","event"],e)>-1,'evtOrMethod needs to be either "event" or "method" got '+e),t=n.isArray(t)?t:[t];for(var i="event"===e?this.events:this.methods,r=0;r<t.length;r++)if(-1===n.indexOf(i,t[r]))return!1;return!0};for(var r=0,o=n.METHODS.all().length;r<o;r++){var s=n.METHODS.all()[r];n.Player.prototype.hasOwnProperty(s)||(n.Player.prototype[s]=i(s))}n.addEvent(e,"message",function(e){var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==n.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src&&n.READIED.push(t.value.src)}),n.Receiver=function(e,t){this.init(e,t)},n.Receiver.prototype.init=function(i,r){var o=this;this.isReady=!1,this.origin=n.origin(t.referrer),this.methods={},this.supported={events:i||n.EVENTS.all(),methods:r||n.METHODS.all()},this.eventListeners={},this.reject=!(e.self!==e.top&&n.POST_MESSAGE),this.reject||n.addEvent(e,"message",function(e){o.receive(e)})},n.Receiver.prototype.receive=function(t){if(t.origin!==this.origin)return!1;var i={};if(n.isObject(t.data))i=t.data;else try{i=e.JSON.parse(t.data)}catch(e){n.log("JSON Parse Error",e)}if(n.log("Receiver.receive",t,i),!i.method)return!1;if(i.context!==n.CONTEXT)return!1;if(-1===n.indexOf(n.METHODS.all(),i.method))return this.emit("error",{code:2,msg:'Invalid Method "'+i.method+'"'}),!1;var r=n.isNone(i.listener)?null:i.listener;if("addEventListener"===i.method)this.eventListeners.hasOwnProperty(i.value)?-1===n.indexOf(this.eventListeners[i.value],r)&&this.eventListeners[i.value].push(r):this.eventListeners[i.value]=[r],"ready"===i.value&&this.isReady&&this.ready();else if("removeEventListener"===i.method){if(this.eventListeners.hasOwnProperty(i.value)){var o=n.indexOf(this.eventListeners[i.value],r);o>-1&&this.eventListeners[i.value].splice(o,1),0===this.eventListeners[i.value].length&&delete this.eventListeners[i.value]}}else this.get(i.method,i.value,r)},n.Receiver.prototype.get=function(e,t,n){var i=this;if(!this.methods.hasOwnProperty(e))return this.emit("error",{code:3,msg:'Method Not Supported"'+e+'"'}),!1;var r=this.methods[e];if("get"===e.substr(0,3)){r.call(this,function(t){i.send(e,t,n)})}else r.call(this,t)},n.Receiver.prototype.on=function(e,t){this.methods[e]=t},n.Receiver.prototype.send=function(t,i,r){if(n.log("Receiver.send",t,i,r),this.reject)return n.log("Receiver.send.reject",t,i,r),!1;var o={context:n.CONTEXT,version:n.VERSION,event:t};n.isNone(i)||(o.value=i),n.isNone(r)||(o.listener=r);var s=JSON.stringify(o);e.parent.postMessage(s,""===this.origin?"*":this.origin)},n.Receiver.prototype.emit=function(e,t){if(!this.eventListeners.hasOwnProperty(e))return!1;n.log("Instance.emit",e,t,this.eventListeners[e]);for(var i=0;i<this.eventListeners[e].length;i++){var r=this.eventListeners[e][i];this.send(e,t,r)}return!0},n.Receiver.prototype.ready=function(){n.log("Receiver.ready"),this.isReady=!0;var t={src:e.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",t)||this.send("ready",t)},n.HTML5Adapter=function(e){if(!(this instanceof n.HTML5Adapter))return new n.HTML5Adapter(e);this.init(e)},n.HTML5Adapter.prototype.init=function(e){n.assert(e,"playerjs.HTML5Adapter requires a video element");var t=this.receiver=new n.Receiver;e.addEventListener("playing",function(){t.emit("play")}),e.addEventListener("pause",function(){t.emit("pause")}),e.addEventListener("ended",function(){t.emit("ended")}),e.addEventListener("timeupdate",function(){t.emit("timeupdate",{seconds:e.currentTime,duration:e.duration})}),e.addEventListener("progress",function(){t.emit("buffered",{percent:e.buffered.length})}),t.on("play",function(){e.play()}),t.on("pause",function(){e.pause()}),t.on("getPaused",function(t){t(e.paused)}),t.on("getCurrentTime",function(t){t(e.currentTime)}),t.on("setCurrentTime",function(t){e.currentTime=t}),t.on("getDuration",function(t){t(e.duration)}),t.on("getVolume",function(t){t(100*e.volume)}),t.on("setVolume",function(t){e.volume=t/100}),t.on("mute",function(){e.muted=!0}),t.on("unmute",function(){e.muted=!1}),t.on("getMuted",function(t){t(e.muted)}),t.on("getLoop",function(t){t(e.loop)}),t.on("setLoop",function(t){e.loop=t})},n.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},n.JWPlayerAdapter=function(e){if(!(this instanceof n.JWPlayerAdapter))return new n.JWPlayerAdapter(e);this.init(e)},n.JWPlayerAdapter.prototype.init=function(e){n.assert(e,"playerjs.JWPlayerAdapter requires a player object");var t=this.receiver=new n.Receiver;this.looped=!1,e.on("pause",function(){t.emit("pause")}),e.on("play",function(){t.emit("play")}),e.on("time",function(e){var n=e.position,i=e.duration;if(!n||!i)return!1;var r={seconds:n,duration:i};t.emit("timeupdate",r)});var i=this;e.on("complete",function(){!0===i.looped?e.seek(0):t.emit("ended")}),e.on("error",function(){t.emit("error")}),t.on("play",function(){e.play(!0)}),t.on("pause",function(){e.pause(!0)}),t.on("getPaused",function(t){t(e.getState().toLowerCase()!=="PLAYING".toLowerCase())}),t.on("getCurrentTime",function(t){t(e.getPosition())}),t.on("setCurrentTime",function(t){e.seek(t)}),t.on("getDuration",function(t){t(e.getDuration())}),t.on("getVolume",function(t){t(e.getVolume())}),t.on("setVolume",function(t){e.setVolume(t)}),t.on("mute",function(){e.setMute(!0)}),t.on("unmute",function(){e.setMute(!1)}),t.on("getMuted",function(t){t(!0===e.getMute())}),t.on("getLoop",function(e){e(this.looped)},this),t.on("setLoop",function(e){this.looped=e},this)},n.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},n.MockAdapter=function(){if(!(this instanceof n.MockAdapter))return new n.MockAdapter;this.init()},n.MockAdapter.prototype.init=function(){var e={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){e.interval=setInterval(function(){e.currentTime+=.25,e.timeupdate({seconds:e.currentTime,duration:e.duration})},250),e.playing=!0},pause:function(){clearInterval(e.interval),e.playing=!1}},t=this.receiver=new n.Receiver;t.on("play",function(){var t=this;e.play(),this.emit("play"),e.timeupdate=function(e){t.emit("timeupdate",e)}}),t.on("pause",function(){e.pause(),this.emit("pause")}),t.on("getPaused",function(t){t(!e.playing)}),t.on("getCurrentTime",function(t){t(e.currentTime)}),t.on("setCurrentTime",function(t){e.currentTime=t}),t.on("getDuration",function(t){t(e.duration)}),t.on("getVolume",function(t){t(e.volume)}),t.on("setVolume",function(t){e.volume=t}),t.on("mute",function(){e.mute=!0}),t.on("unmute",function(){e.mute=!1}),t.on("getMuted",function(t){t(e.mute)}),t.on("getLoop",function(t){t(e.loop)}),t.on("setLoop",function(t){e.loop=t})},n.MockAdapter.prototype.ready=function(){this.receiver.ready()},n.VideoJSAdapter=function(e){if(!(this instanceof n.VideoJSAdapter))return new n.VideoJSAdapter(e);this.init(e)},n.VideoJSAdapter.prototype.init=function(e){n.assert(e,"playerjs.VideoJSReceiver requires a player object");var t=this.receiver=new n.Receiver;$player=$(e),$player.on("pause",function(){t.emit("pause")}),$player.on("play",function(){t.emit("play")}),$player.on("timeupdate",function(n){var i=e.currentTime(),r=e.duration();if(!i||!r)return!1;var o={seconds:i,duration:r};t.emit("timeupdate",o)}),$player.on("ended",function(){t.emit("ended")}),$player.on("error",function(){t.emit("error")}),$("video").each(function(){this.addEventListener("playing",function(){t.emit("play")}),this.addEventListener("pause",function(){t.emit("pause")}),this.addEventListener("ended",function(){t.emit("ended")})}),t.on("play",function(){e.play()}),t.on("pause",function(){e.pause()}),t.on("getPaused",function(t){t(e.paused())}),t.on("getCurrentTime",function(t){t(e.currentTime())}),t.on("setCurrentTime",function(t){e.currentTime(t)}),t.on("getDuration",function(t){t(e.duration())}),t.on("getVolume",function(t){t(100*e.volume())}),t.on("setVolume",function(t){e.volume(t/100)}),t.on("mute",function(){e.volume(0)}),t.on("unmute",function(){e.volume(1)}),t.on("getMuted",function(t){t(0===e.volume())}),t.on("getLoop",function(t){t(e.loop())}),t.on("setLoop",function(t){e.loop(t)})},n.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:e.playerjs=n}(window,document);
